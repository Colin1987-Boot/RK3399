#!/bin/bash
repo_array=(
#repo name			29 path					github path		211 path				branch
LocalPlayer			linux/external/LocalPlayer		LocalPlayer		linux/external/LocalPlayer		master
QLauncher			linux/app/QLauncher			QLauncher		linux/app/QLauncher			master
alsa-config			linux/external/alsa-config		alsa-config		linux/external/alsa-config		master
audioservice			linux/external/audioservice		audioservice		linux/external/audioservice		master
buildroot			rk/rk1108/buildroot			buildroot		rk/rk1108/buildroot			rockchip/2018.02-rc3
camera				linux/app/camera			camera			linux/app/camera			master
camera_engine_cifisp		linux/external/camera_engine_cifisp	camera_engine_cifisp	linux/external/camera_engine_cifisp	master
camera_engine_rkisp		linux/external/camera_engine_rkisp	camera_engine_rkisp	linux/external/camera_engine_rkisp	master
distro				linux/distro				distro			linux/distro				master
dl				linux/buildroot/dl			dl			linux/buildroot/dl			master
docs				linux/docs				docs			linux/docs				master
ffmpeg				linux/external/ffmpeg			ffmpeg			linux/external/ffmpeg			rockchip/release/4.0
gallery				linux/app/gallery			gallery			linux/app/gallery			master
gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu	rk/prebuilts/gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu		gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu	rk/prebuilts/gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu		master
gcc-linaro-6.3.1-2017.05-x86_64_arm-linux-gnueabihf	rk/prebuilts/gcc-linaro-6.3.1-2017.05-x86_64_arm-linux-gnueabihf	gcc-linaro-6.3.1-2017.05-x86_64_arm-linux-gnueabihf	rk/prebuilts/gcc-linaro-6.3.1-2017.05-x86_64_arm-linux-gnueabihf	master
gstreamer-camera		linux/external/gstreamer-camera		gstreamer-camera	linux/external/gstreamer-camera		master
gstreamer-rockchip		linux/gstreamer-rockchip		gstreamer-rockchip	linux/gstreamer-rockchip		master
kernel				rk/kernel				kernel			rk/kernel				develop-4.4
libdrm-rockchip			linux/libdrm-rockchip			libdrm-rockchip		linux/libdrm-rockchip			rockchip-2.4.68
libmali				linux/libmali				libmali			linux/libmali				master
linux-rga			linux/linux-rga				linux-rga		linux/linux-rga				master
minigui				linux/external/minigui			minigui			linux/external/minigui			master
mpp				rk/mpp					mpp			rk/mpp					develop
mpv				linux/external/mpv			mpv			linux/external/mpv			rockchip/release/0.9
music				linux/app/music				music			linux/app/music				master
powermanager			linux/external/powermanager		powermanager		linux/external/powermanager		master
recovery			linux/recovery				recovery		linux/recovery				develop
rk-rootfs-build			linux/rk-rootfs-build			rk-rootfs-build		linux/rk-rootfs-build			master
rk_pcba_test			linux/external/rk_pcba_test		rk_pcba_test		linux/external/rk_pcba_test		master
bin				linux/security/bin			bin			linux/security/bin			master
rk_tee_user			android/rk/platform/system/rk_tee_user	rk_tee_user		android/rk/platform/system/rk_tee_user	develop-next
rkbin				rk/rkbin				rkbin			rk/rkbin				master
# rknpu				linux/external/rknpu			rknpu			linux/external/rknpu			master
rkssd				linux/external/rkssd			rkssd			linux/external/rkssd			master
rkupdate			linux/external/rkupdate			rkupdate		linux/external/rkupdate			master
rkwifibt			linux/external/rkwifibt			rkwifibt		linux/external/rkwifibt			master
rockchip			linux/device/rockchip			device-custom		linux/device/rockchip			master
settings 			linux/app/settings			settings		linux/app/settings			master
softapDemo			linux/external/softapDemo		softapDemo		linux/external/softapDemo		master
softapServer			linux/external/softapServer		softapServer		linux/external/softapServer		master
wifiAutoSetup			linux/external/wifiAutoSetup		wifiAutoSetup		linux/external/wifiAutoSetup		master
tensorflow			linux/external/tensorflow		tensorflow		linux/external/tensorflow		master
tools				linux/tools				tools			linux/tools				master
u-boot				android/rk/u-boot			u-boot			android/rk/u-boot			next-dev
video				linux/app/video				video			linux/app/video				master
)

function sync_repo(){
	len=${#repo_array[@]}
	echo "repo array len is $len"
	for((i=0;i<len;i+=5))
	do
		repo_name=${repo_array[i]}
		path_29=${repo_array[i+1]}
		path_github=${repo_array[i+2]}
		path_211=${repo_array[i+3]}
		branch=${repo_array[i+4]}

		if [ ! -d $repo_name ]; then
			git clone ssh://10.10.10.29:29418/$path_29 -b $branch $repo_name
		fi

		cd $repo_name
		echo "start syncing $repo_name"
		git pull
		if [ $path_github != "none" ]; then
			remote_github="`git remote -v | grep github`"
			if [ -z "$remote_github" ]; then
				git remote add github https://rkchrome:rk83991906@github.com/rockchip-linux/$path_github
			fi
			git fetch github
			git push -f github $branch:$branch
			echo "sync $repo_name to github done"
		fi

		if [ $path_211 != "none" ]; then
			remote_211="`git remote -v | grep server211`"
			if [ -z "$remote_211" ]; then
				git remote add server211 ssh://git@10.10.10.211/linux/$path_211
			fi
			git fetch server211
			git push -f server211 $branch:$branch
			echo "sync $repo_name to server 211 done"
		fi
		cd ..
	done
}


while true
do
	sync_repo
	sleep 1h
done
